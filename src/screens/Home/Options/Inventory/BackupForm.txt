import React, { useState, useEffect } from 'react';
import { RoundedScrollContainer, SafeAreaView } from '@components/containers';
import { NavigationHeader } from '@components/Header';
import { TextInput as FormInput } from '@components/common/TextInput';
import { DropdownSheet } from '@components/common/BottomSheets';
import {
  fetchInvoiceDropdown,
  fetchPurchaseReturnDropdown,
  fetchSalesReturnDropdown,
  fetchServiceDropdown,
  fetchServiceReturnDropdown,
  fetchStockTransferDropdown,
  fetchVendorBillDropdown
} from '@api/dropdowns/dropdownApi';

const formatDropdownData = (data) => {
  return data.map(item => ({
    id: item._id,
    label: item.sequence_no
  }));
};

const fetchDropdownData = async () => {
  try {
    const [
      invoiceData,
      purchaseReturnData,
      salesReturnData,
      serviceData,
      serviceReturnData,
      stockTransferData,
      vendorBillData
    ] = await Promise.all([
      fetchInvoiceDropdown(),
      fetchPurchaseReturnDropdown(),
      fetchSalesReturnDropdown(),
      fetchServiceDropdown(),
      fetchServiceReturnDropdown(),
      fetchStockTransferDropdown(),
      fetchVendorBillDropdown(),
    ]);

    const formattedData = {
      invoice: formatDropdownData(invoiceData),
      purchaseReturn: formatDropdownData(purchaseReturnData),
      salesReturn: formatDropdownData(salesReturnData),
      service: formatDropdownData(serviceData),
      serviceReturn: formatDropdownData(serviceReturnData),
      stockTransfer: formatDropdownData(stockTransferData),
      vendorBill: formatDropdownData(vendorBillData),
    };

    return formattedData;
  } catch (error) {
    console.error('Error fetching dropdown data:', error);
    throw error;
  }
};

const InventoryForm = ({ navigation }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [selectedType, setSelectedType] = useState(null);
  const [dropdownData, setDropdownData] = useState({});
  console.log("ðŸš€ ~ InventoryForm ~ dropdownData:", dropdownData)
  const [formData, setFormData] = useState({
    reason: '',
    sales: '',
    service: '',
    purchase: '',
    serviceReturn: '',
    purchaseReturn: '',
    salesReturn: '',
    stockTransfer: '',
    remarks: '',
  });

  useEffect(() => {
    const fetchData = async () => {
      try {
        const data = await fetchDropdownData();
        setDropdownData(data);
      } catch (error) {
        console.error('Error fetching dropdown data:', error);
      }
    };
    fetchData();
  }, []);

  const handleFieldChange = (field, value) => {
    setFormData({
      ...formData,
      [field]: value,
    });
  };

  const toggleBottomSheet = (type) => {
    setSelectedType(type);
    setIsVisible(!isVisible);
  };

  const renderBottomSheet = () => {
    let items = [];
    switch (selectedType) {
      case 'Select Reason':
        items = dropdownData.invoice || [];
        break;
      // Add other cases here if needed
      default:
        return null;
    }

    return (
      <DropdownSheet
        isVisible={isVisible}
        items={items}
        title={'Select Reasons'}
        onClose={() => setIsVisible(false)}
      />
    );
  };

  return (
    <SafeAreaView>
      <NavigationHeader
        title={'Box Opening Request'}
        onBackPress={() => navigation.goBack()}
      />
      <RoundedScrollContainer>
        <FormInput
          label={'Select Reasons'}
          placeholder={'Select Reason'}
          dropIcon={'menu-down'}
          editable={false}
          value={formData.reason}
          multiline={true}
          onPress={() => toggleBottomSheet('Select Reason')}
        />
        <FormInput
          label={'Remarks'}
          multiline={true}
          numberOfLines={5}
          placeholder={'Enter remarks'}
          onChangeText={(text) => handleFieldChange('remarks', text)}
        />
        {renderBottomSheet()}
      </RoundedScrollContainer>
    </SafeAreaView>
  );
};

export default InventoryForm;





import React, { useState, useEffect } from 'react';
import { RoundedScrollContainer, SafeAreaView } from '@components/containers';
import { NavigationHeader } from '@components/Header';
import { TextInput as FormInput } from '@components/common/TextInput';
import { DropdownSheet } from '@components/common/BottomSheets';
import {
  fetchInvoiceDropdown,
  fetchPurchaseReturnDropdown,
  fetchSalesReturnDropdown,
  fetchServiceDropdown,
  fetchServiceReturnDropdown,
  fetchStockTransferDropdown,
  fetchVendorBillDropdown
} from '@api/dropdowns/dropdownApi';
import { useDropdownFetching } from '@hooks';


const InventoryForm = ({ navigation }) => {
  const [isVisible, setIsVisible] = useState(false);
  const [selectedType, setSelectedType] = useState(null);


  const [dropdownData, setDropdownData] = useState({});
  const [formData, setFormData] = useState({
    reason: '',
    sales: '',
    service: '',
    purchase: '',
    serviceReturn: '',
    purchaseReturn: '',
    salesReturn: '',
    stockTransfer: '',
    remarks: '',
  });

  // const { data: invoice, fetchData: fetchInvoiceDropdownData } = useDropdownFetching(fetchInvoiceDropdown);
  // const { data: salesReturn, fetchData: fetchSalesReturnDropdownData } = useDropdownFetching(fetchSalesReturnDropdown);
  // const { data: purchaseReturn, fetchData: fetchPurchaseReturnDropdownData } = useDropdownFetching(fetchPurchaseReturnDropdown);
  // const { data: service, fetchData: fetchServiceDropdownData } = useDropdownFetching(fetchServiceDropdown);
  // const { data: serviceReturn, fetchData: fetchServiceRetunDropdownData } = useDropdownFetching(fetchServiceReturnDropdown);
  // const { data: stockTransfer, fetchData: fetchStockTransferDropdownData } = useDropdownFetching(fetchStockTransferDropdown);
  // const { data: vendorBill, fetchData: fetchVendorBillDropdownData } = useDropdownFetching(fetchVendorBillDropdown);





  useEffect(() => {
    const fetchData = async () => {
      fetchInvoiceDropdown().then(res => res.map(data => {id: data._id, label: data.sequence_no}))
      fetchPurchaseReturnDropdown()
      fetchSalesReturnDropdown()
      fetchServiceDropdown()
      fetchServiceReturnDropdown()
      fetchStockTransferDropdown()
      fetchVendorBillDropdown()
    };
    fetchData();
  }, []);

  const handleFieldChange = (field, value) => {
    setFormData({
      ...formData,
      [field]: value,
    });
  };

  const toggleBottomSheet = (type) => {
    setSelectedType(type);
    setIsVisible(!isVisible);
  };

  const renderBottomSheet = () => {
    let items = [];
    switch (selectedType) {
      case 'Select Reason':
        items = dropdownData.invoice || [];
        break;
      // Add other cases here if needed
      default:
        return null;
    }

    return (
      <DropdownSheet
        isVisible={isVisible}
        items={items}
        title={'Select Reasons'}
        onClose={() => setIsVisible(false)}
      />
    );
  };

  return (
    <SafeAreaView>
      <NavigationHeader
        title={'Box Opening Request'}
        onBackPress={() => navigation.goBack()}
      />
      <RoundedScrollContainer>
        <FormInput
          label={'Select Reasons'}
          placeholder={'Select Reason'}
          dropIcon={'menu-down'}
          editable={false}
          value={formData.reason}
          multiline={true}
          onPress={() => toggleBottomSheet('Select Reason')}
        />
        <FormInput
          label={'Remarks'}
          multiline={true}
          numberOfLines={5}
          placeholder={'Enter remarks'}
          onChangeText={(text) => handleFieldChange('remarks', text)}
        />
        {renderBottomSheet()}
      </RoundedScrollContainer>
    </SafeAreaView>
  );
};

export default InventoryForm;

